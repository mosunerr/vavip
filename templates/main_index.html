{% extends "layout.html" %}
{% block title %}Главная страница Vavip{% endblock %}
{% block content %}
<style>
  .video-background {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    z-index: -1;
    background: black;
  }
  .video-background video {
    position: absolute;
    top: 50%;
    left: 50%;
    min-width: 100%;
    min-height: 100%;
    width: auto;
    height: auto;
    transform: translate(-50%, -50%) scale(1);
    object-fit: cover;
    transition: transform 1s ease;
    opacity: 1 !important;
    will-change: transform;
  }
  main.content {
    position: relative;
    z-index: 1;
    margin-top: 20px;
    max-width: 1200px;
    padding: 0 20px;
    color: white;
  }
  .content-section {
    display: none;
    margin-top: 40px;
  }
  .content-section.active {
    display: block;
  }
  .spacer {
    height: 1500px;
  }
  .centered-link-wrapper {
    position: fixed;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 2;
    pointer-events: auto;
    text-align: center;
  }
  .section-link {
    font-family: 'Helvetica', 'Arial', sans-serif;
    font-weight: 300;
    font-size: 1.8rem;
    color: #c0c0c0;
    text-decoration: none;
    padding: 5px 40px;
    border-radius: 200px;
    cursor: pointer;
    transition: all 0.5s ease;
    letter-spacing: 1.5px;
  }
  .section-link:hover {
    background-color: #2600ff8d;
    color: #e66fef;
  }

  /* Панель управления */
  .control-panel {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: linear-gradient(135deg, #1f1f1f, #3a3a3a);
    padding: 15px;
    border-radius: 10px;
    color: white;
    font-size: 14px;
    max-width: 340px;
    z-index: 50;
    pointer-events: auto;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    transition: max-height 0.4s ease, padding 0.4s ease;
    overflow: hidden;
    max-height: 500px; /* развернуто */
  }

  .control-panel.collapsed {
    max-height: 40px; /* свернуто в одну строку */
    padding: 5px 15px;
  }

  .control-panel label {
    display: block;
    margin-bottom: 6px;
  }
  .control-panel input[type="range"], .control-panel select, .control-panel input[type="color"] {
    width: 100%;
    margin-bottom: 15px;
    pointer-events: auto;
    padding: 3px 6px;
    border-radius: 5px;
    border: none;
    background: #2a2a2a;
    color: white;
  }

  .toggle-btn {
    background: #2600ff;
    color: white;
    border: none;
    padding: 4px 10px;
    border-radius: 5px;
    cursor: pointer;
    margin-bottom: 10px;
    font-weight: 600;
  }
</style>

<div class="video-background">
  <video autoplay muted loop playsinline preload="auto" id="bg-video" poster="{{ url_for('static', filename='images/video-poster.jpg') }}">
    <source src="{{ url_for('static', filename='videos/background1.mp4') }}" type="video/mp4" />
    Ваш браузер не поддерживает видео.
  </video>
</div>

<div class="centered-link-wrapper" id="centeredLink">
  <a href="{{ url_for('catalog') }}" class="section-link" id="catalog-link">САНТЕХНИЧЕСКИЕ УЗЛЫ ВВОДА VAVIP</a>
</div>

<main class="content">
  <div id="sections">
    <div class="content-section active" data-index="0">
      <p>Содержимое для первого видео</p>
    </div>
    <div class="content-section" data-index="1">
      <p>Содержимое для второго видео</p>
    </div>
    <div class="content-section" data-index="2">
      <p>Саныч всегда прав!!!</p>
    </div>
  </div>
  <div class="spacer"></div>
</main>

<div class="control-panel" id="controlPanel">
  <button class="toggle-btn" id="togglePanel">Развернуть / Свернуть</button>

  <label for="topRange">Вертикальное положение (bottom %): <span id="topValue">60</span></label>
  <input type="range" id="topRange" min="0" max="100" value="60">
  
  <label for="leftRange">Горизонтальное положение (left %): <span id="leftValue">50%</span></label>
  <input type="range" id="leftRange" min="0" max="100" value="50">
  
  <label for="weightRange">Вес шрифта (font-weight): <span id="weightValue">300</span></label>
  <input type="range" id="weightRange" min="100" max="900" step="100" value="300">
  
  <label for="sizeRange">Размер шрифта (px): <span id="sizeValue">28</span></label>
  <input type="range" id="sizeRange" min="16" max="60" value="28">

  <label for="fontSelect">Шрифт:</label>
  <select id="fontSelect">
    <option value="Helvetica, Arial, sans-serif" selected>Helvetica</option>
    <option value="'Arial', sans-serif">Arial</option>
    <option value="'Times New Roman', serif">Times New Roman</option>
    <option value="'Courier New', monospace">Courier New</option>
    <option value="'Verdana', sans-serif">Verdana</option>
    <option value="'Futura', sans-serif">Futura</option>
    <option value="'Gill Sans', sans-serif">Gill Sans</option>
    <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
    <option value="'Roboto', sans-serif">Roboto</option>
    <option value="'Open Sans', sans-serif">Open Sans</option>
  </select>

  <label for="colorPicker">Цвет текста:</label>
  <input type="color" id="colorPicker" value="#c0c0c0">
</div>

<script>
  const videos = [
    "{{ url_for('static', filename='videos/background1.mp4') }}",
    "{{ url_for('static', filename='videos/background2.mp4') }}",
    "{{ url_for('static', filename='videos/background3.mp4') }}"
  ];
  const videoElement = document.getElementById('bg-video');
  const contentSections = document.querySelectorAll('.content-section');
  let currentVideoIndex = 0;

  async function changeVideoIndex(index) {
    if(index === currentVideoIndex) return;
    videoElement.pause();
    videoElement.src = videos[index];
    videoElement.load();
    await videoElement.play().catch(e => console.error('Video play error:', e));

    videoElement.style.transition = "transform 1s ease";
    videoElement.style.transform = index === 2 ? "translate(-50%, -50%) scale(0.5)" : "translate(-50%, -50%) scale(1)";

    contentSections.forEach(section => {
      section.classList.toggle('active', Number(section.dataset.index) === index);
    });
    currentVideoIndex = index;
  }

  function debounce(func, wait = 400) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }

  const onScrollDebounced = debounce(() => {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollPercent = (scrollTop / docHeight) * 100;
    if(scrollPercent < 33) changeVideoIndex(0);
    else if(scrollPercent < 67) changeVideoIndex(1);
    else changeVideoIndex(2);
  }, 400);
  window.addEventListener('scroll', onScrollDebounced);

  window.onload = () => {
    contentSections.forEach(section => {
      section.classList.toggle('active', Number(section.dataset.index) === 0);
    });
  }

  const centeredLink = document.getElementById('centeredLink');
  const link = document.getElementById('catalog-link');

  const topRange = document.getElementById('topRange');
  const leftRange = document.getElementById('leftRange');
  const weightRange = document.getElementById('weightRange');
  const sizeRange = document.getElementById('sizeRange');
  const fontSelect = document.getElementById('fontSelect');
  const colorPicker = document.getElementById('colorPicker');
  const topValue = document.getElementById('topValue');
  const leftValue = document.getElementById('leftValue');
  const weightValue = document.getElementById('weightValue');
  const sizeValue = document.getElementById('sizeValue');

  topRange.addEventListener('input', () => {
    centeredLink.style.bottom = topRange.value + '%';
    topValue.textContent = topRange.value;
  });
  leftRange.addEventListener('input', () => {
    centeredLink.style.left = leftRange.value + '%';
    leftValue.textContent = leftRange.value + '%';
  });
  weightRange.addEventListener('input', () => {
    link.style.fontWeight = weightRange.value;
    weightValue.textContent = weightRange.value;
  });
  sizeRange.addEventListener('input', () => {
    link.style.fontSize = sizeRange.value + 'px';
    sizeValue.textContent = sizeRange.value;
  });
  fontSelect.addEventListener('change', () => {
    link.style.fontFamily = fontSelect.value;
  });
  colorPicker.addEventListener('input', () => {
    link.style.color = colorPicker.value;
  });

  // Свернуть / развернуть панель
  const controlPanel = document.getElementById('controlPanel');
  const toggleBtn = document.getElementById('togglePanel');
  toggleBtn.addEventListener('click', () => {
    controlPanel.classList.toggle('collapsed');
  });
</script>
{% endblock %}
