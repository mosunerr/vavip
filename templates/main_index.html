{% extends "layout.html" %}
{% block title %}Главная страница Vavip{% endblock %}
{% block content %}
<style>
  /* Видео и фон */
  .video-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    z-index: 1;
  }

  .video-background video {
    position: absolute;
    top: 50%;
    left: 50%;
    min-width: 100%;
    min-height: 100%;
    width: auto;
    height: auto;
    transform: translate(-50%, -50%);
    object-fit: cover;
  }

  /* Кликабельная зона для верхних 80% */
  .click-zone {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 80vh; /* верхние 80% экрана */
    z-index: 2;
    cursor: pointer;
  }

  /* Контент и кнопки */
  .index-page {
    position: relative;
    z-index: 3;
    max-width: 1200px;
    margin: 0 auto;
    padding: 170px 40px 40px 40px;
    color: white;
  }

  .content-section {
    display: none;
    margin-top: 40px;
  }
  .content-section.active {
    display: block;
  }
  .spacer {
    height: 1500px;
  }

  .centered-link-wrapper {
    position: fixed;
    bottom: 8%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 4;
    text-align: center;
  }

  .section-link {
    font-family: Helvetica, Arial, sans-serif;
    font-weight: 300;
    font-size: 30px;
    color: #c0c0c0;
    text-decoration: none;
    padding: 5px 40px;
    border-radius: 200px;
    cursor: pointer;
    transition: all 0.5s ease;
    letter-spacing: 1.5px;
  }
  .section-link:hover {
    background-color: #2600ff8d;
    color: #e66fef;
  }
</style>

<!-- Видео -->
<div class="video-background">
  <video autoplay muted loop playsinline preload="auto" id="bg-video" poster="{{ url_for('static', filename='images/video-poster.jpg') }}">
    <source src="{{ url_for('static', filename='videos/background1.mp4') }}" type="video/mp4" />
    Ваш браузер не поддерживает видео.
  </video>
</div>

<!-- Кликабельная зона на верхние 80% -->
<div class="click-zone" onclick="window.location.href='{{ url_for('catalog') }}'"></div>

<div class="centered-link-wrapper">
  <a href="{{ url_for('catalog') }}" class="section-link">САНТЕХНИЧЕСКИЕ УЗЛЫ ВВОДА VAVIP</a>
</div>

<main class="index-page">
  <div id="sections">
    <div class="content-section active" data-index="0">
      <p>Содержимое для первого видео</p>
    </div>
    <div class="content-section" data-index="1">
      <p>Содержимое для второго видео</p>
    </div>
    <div class="content-section" data-index="2">
      <p>Саныч всегда прав!!!</p>
    </div>
  </div>
  <div class="spacer"></div>
</main>

<script>
  const videos = [
    "{{ url_for('static', filename='videos/background1.mp4') }}",
    "{{ url_for('static', filename='videos/background2.mp4') }}",
    "{{ url_for('static', filename='videos/background3.mp4') }}"
  ];
  const videoElement = document.getElementById('bg-video');
  const contentSections = document.querySelectorAll('.content-section');
  let currentVideoIndex = 0;

  async function changeVideoIndex(index) {
    if(index === currentVideoIndex) return;
    videoElement.pause();
    videoElement.src = videos[index];
    videoElement.load();
    await videoElement.play().catch(e => console.error('Video play error:', e));

    videoElement.style.transition = "transform 1s ease";
    videoElement.style.transform = index === 2 ? "translate(-50%, -50%) scale(0.5)" : "translate(-50%, -50%) scale(1)";

    contentSections.forEach(section => {
      section.classList.toggle('active', Number(section.dataset.index) === index);
    });
    currentVideoIndex = index;
  }

  function debounce(func, wait = 400) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }

  const onScrollDebounced = debounce(() => {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollPercent = (scrollTop / docHeight) * 100;
    if(scrollPercent < 33) changeVideoIndex(0);
    else if(scrollPercent < 67) changeVideoIndex(1);
    else changeVideoIndex(2);
  }, 400);
  window.addEventListener('scroll', onScrollDebounced);

  window.onload = () => {
    contentSections.forEach(section => {
      section.classList.toggle('active', Number(section.dataset.index) === 0);
    });
  }
</script>
{% endblock %}
